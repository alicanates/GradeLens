{% extends 'core/base.html' %}
{% load static %}

{% block title %}Öğrenci Listesi{% endblock %}

{% block content %}
<div class="welcome-dashboard">
    <div class="header-section text-center mb-5">
        <div class="page-title-container mb-4 p-4">
            <h1 class="page-title mb-3">Öğrenci Listesi</h1>
            <p class="page-description">
                Sistemde kayıtlı tüm öğrencileri listeleyin, arama yapın ve analizlerini görüntüleyin.
            </p>
        </div>
    </div>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div></div> <!-- Başlık alanına göre düzenlemek için boş bırakılmış -->
            <div class="d-flex gap-2">
                <a href="?export=excel{% if search_query %}&search={{ search_query }}{% endif %}"
                   class="btn btn-success">
                    Excel'e Aktar
                </a>
            </div>
        </div>

        <!-- Arama Formu -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-8">
                        <input type="text"
                               class="form-control"
                               name="search"
                               value="{{ search_query }}"
                               placeholder="Öğrenci no veya isim ile ara...">
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary">Ara</button>
                        {% if search_query %}
                            <a href="{% url 'student_list' %}" class="btn btn-secondary">Temizle</a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <!-- Sonuç Bilgisi -->
        <div class="mb-3">
            <small class="text-muted">
                Toplam {{ page_obj.paginator.count }} öğrenci bulundu.
            </small>
        </div>

        <!-- Tablo -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>
                                    <a href="?sort={% if sort_field == 'student_number' and sort_direction == 'asc' %}-{% endif %}student_number{% if search_query %}&search={{ search_query }}{% endif %}"
                                       class="text-dark text-decoration-none table-header-link">
                                        Öğrenci No
                                        {% if sort_field == 'student_number' %}
                                            {% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}
                                        {% endif %}
                                    </a>
                                </th>
                                <th>
                                    <a href="?sort={% if sort_field == 'full_name' and sort_direction == 'asc' %}-{% endif %}full_name{% if search_query %}&search={{ search_query }}{% endif %}"
                                       class="text-dark text-decoration-none table-header-link">
                                        Ad Soyad
                                        {% if sort_field == 'full_name' %}
                                            {% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}
                                        {% endif %}
                                    </a>
                                </th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in page_obj %}
                            <tr>
                                <td>{{ student.student_number }}</td>
                                <td>{{ student.full_name }}</td>
                                <td>
                                    <a href="{% url 'student_analysis' student.student_number %}"
                                       class="btn btn-sm btn-info">
                                        Analiz
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center">Öğrenci bulunamadı.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sayfalama -->
        {% if page_obj.paginator.num_pages > 1 %}
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link"
                           href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                            İlk
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                            Önceki
                        </a>
                    </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
                            <a class="page-link"
                               href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                {{ num }}
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                            Sonraki
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                            Son
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}
